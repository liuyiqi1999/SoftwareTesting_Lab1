{"remainingRequest":"/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/node_modules/vue-loader/lib/index.js??vue-loader-options!/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/src/views/LoanRepayment/Index.vue?vue&type=script&lang=js&","dependencies":[{"path":"/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/src/views/LoanRepayment/Index.vue","mtime":1618069263775},{"path":"/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/node_modules/babel-loader/lib/index.js","mtime":315532800000},{"path":"/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/Users/liuyiqi/NutstoreFiles/同步文档/2020第二学期课程/软件测试/lab1/SoftwareTesting_Lab1/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCBTZWFyY2hVc2VyIGZyb20gIkAvY29tcG9uZW50cy9TZWFyY2hVc2VyIjsKCmV4cG9ydCBkZWZhdWx0IHsKICBuYW1lOiAiSW5kZXgiLAogIGNvbXBvbmVudHM6IHtTZWFyY2hVc2VyfSwKICBkYXRhKCkgewogICAgcmV0dXJuIHsKICAgICAgdGFibGVEYXRhOiBbXSwKICAgICAgY29kZTogIiIsCiAgICAgIG5hbWU6ICIiLAogICAgICByZXBheURpYWxvZ1Zpc2libGU6IGZhbHNlLAogICAgICB1bnBheVRhYmxlRGF0YTogW10sCiAgICAgIHRvdGFsRmluZTogMCwKICAgICAgcGFpZEZpbmU6IGZhbHNlLAogICAgICBwYXJ0UmVwYXlBbW91bnQ6IG51bGwsCiAgICAgIHBheU92ZXJkdWVBbW91bnQ6IDAsCiAgICB9CiAgfSwKICBtZXRob2RzOiB7CiAgICBhc3luYyBzaG93RGF0YShkYXRhKSB7CiAgICAgIHRoaXMuY29kZSA9IGRhdGEuY29kZQogICAgICB0aGlzLm5hbWUgPSBkYXRhLm5hbWUKICAgICAgbGV0IGxvYW5zID0gYXdhaXQgdGhpcy5nZXRMb2FuTGlzdCh0aGlzLmNvZGUpCiAgICAgIGxldCB0ZW1wRGF0YSA9IFtdCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbG9hbnMubGVuZ3RoOyBpKyspIHsKICAgICAgICBsZXQgdGVtcCA9IHt9CiAgICAgICAgdGVtcC5pb3VOdW0gPSBsb2Fuc1tpXS5pb3VOdW0KICAgICAgICB0ZW1wLm92ZXJkdWVBbW91bnQgPSBsb2Fuc1tpXS5kdWVCYWxhbmNlCiAgICAgICAgdGVtcC5jcmVhdGVUaW1lID0gbG9hbnNbaV0ubG9hZERhdGUuc3BsaXQoIlQiKVswXQogICAgICAgIHRlbXAucHJvZHVjdE5hbWUgPSBsb2Fuc1tpXS5wcm9kdWN0TmFtZQogICAgICAgIHRlbXAucHJvZHVjdENvZGUgPSBsb2Fuc1tpXS5wcm9kdWN0Q29kZQogICAgICAgIHRlbXBEYXRhLnB1c2godGVtcCkKICAgICAgfQogICAgICB0aGlzLnRhYmxlRGF0YSA9IHRlbXBEYXRhCiAgICB9LAogICAgYXN5bmMgZ2V0TG9hbkxpc3QoY29kZSkgewogICAgICBsZXQgcmVzcG9uc2UgPSBhd2FpdCB0aGlzLmF4aW9zLmdldCgnL2xvYW4vY3VzdG9tZXJMb2Fucz9jb2RlPScgKyBjb2RlKQogICAgICBsZXQgbG9hbkxpc3QgPSByZXNwb25zZS5kYXRhCiAgICAgIHJldHVybiBsb2FuTGlzdAogICAgfSwKICAgIHJlcGF5KHJvdykgewogICAgICB0aGlzLnBheU92ZXJkdWVBbW91bnQgPSByb3cub3ZlcmR1ZUFtb3VudAogICAgICB0aGlzLnJlcGF5RGlhbG9nVmlzaWJsZSA9IHRydWUKICAgICAgbGV0IHRoYXQgPSB0aGlzCiAgICAgIHRoaXMuYXhpb3MuZ2V0KCcvbG9hbi91blBheVBsYW5zP2lvdU51bT0nICsgcm93LmlvdU51bSkKICAgICAgICAgIC50aGVuKHJlc3BvbnNlID0+IHsKICAgICAgICAgICAgbGV0IHVuUGF5UGxhbnMgPSByZXNwb25zZS5kYXRhCiAgICAgICAgICAgIGxldCB0ZW1wRGF0YSA9IFtdCiAgICAgICAgICAgIGZvcihsZXQgaT0wO2k8dW5QYXlQbGFucy5sZW5ndGg7aSsrKXsKICAgICAgICAgICAgICBsZXQgdGVtcCA9IHVuUGF5UGxhbnNbaV0KICAgICAgICAgICAgICB0ZW1wLnBsYW5OdW0gPSAi56ysIit0ZW1wLnBsYW5OdW0rIuacnyIKICAgICAgICAgICAgICB0ZW1wLnBsYW5EYXRlID0gdGVtcC5wbGFuRGF0ZS5zcGxpdCgiVCIpWzBdCiAgICAgICAgICAgICAgc3dpdGNoICh0ZW1wLnN0YXR1cykgewogICAgICAgICAgICAgICAgY2FzZSAwOiB0ZW1wLnN0YXR1cyA9ICLpu5jorqQiCiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgICBjYXNlIDE6IHRlbXAuc3RhdHVzID0gIumAvuacn++8jOaciee9mumHkeacqui/mCIKICAgICAgICAgICAgICAgICAgYnJlYWsKICAgICAgICAgICAgICAgIGNhc2UgMjogdGVtcC5zdGF0dXMgPSAi6YC+5pyf77yM5bey6L+Y572a6YeRIgogICAgICAgICAgICAgICAgICBicmVhawogICAgICAgICAgICAgICAgY2FzZSAzOiB0ZW1wLnN0YXR1cyA9ICLmraPluLjov5jmrL4iCiAgICAgICAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIHRlbXBEYXRhLnB1c2godGVtcCkKICAgICAgICAgICAgICB0aGF0LnRvdGFsRmluZSArPSB0ZW1wLmZpbmUKICAgICAgICAgICAgfQogICAgICAgICAgICB0aGF0LnVucGF5VGFibGVEYXRhID0gdGVtcERhdGEKICAgICAgICAgIH0pCiAgICB9LAogICAgcGF5RmluZShyb3cpewogICAgICBsZXQgdGhhdCA9IHRoaXMKICAgICAgdGhpcy5heGlvcy5wb3N0KCcvbG9hbi9maW5lJyx7CiAgICAgICAgaW91TnVtOiByb3cuaW91TnVtCiAgICAgIH0pCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpCiAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZT09PSJyZXBheSBmaW5lIHN1Y2Nlc3MiKSB0aGF0LiRtZXNzYWdlKCfmlK/ku5jnvZrph5HmiJDlip8nKQogICAgICAgICAgICBlbHNlIHRoYXQuJG1lc3NhZ2UoJ+aUr+S7mOe9mumHkeWksei0pScpCiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKGVycm9yID0+IHsKICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpCiAgICAgICAgICB9KQogICAgfSwKICAgIHJlcGF5QWxsKHJvdyl7CiAgICAgIGxldCB0aGF0ID0gdGhpcwogICAgICB0aGlzLmF4aW9zLnBvc3QoJy9sb2FuL3JlcGF5L2FsbCcsIHsKICAgICAgICBpb3VOdW06IHJvdy5pb3VOdW0sCiAgICAgIH0pCiAgICAgICAgLnRoZW4ocmVzcG9uc2UgPT4gewogICAgICAgICAgY29uc29sZS5sb2cocmVzcG9uc2UuZGF0YSkKICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZT09PSJzdWNjZXNzIikgdGhhdC4kbWVzc2FnZSgn6L+Y5qy+5oiQ5YqfJykKICAgICAgICAgIGVsc2UgdGhhdC4kbWVzc2FnZSgn6L+Y5qy+5aSx6LSlJykKICAgICAgICB9KQogICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcikKICAgICAgICB9KQogICAgfSwKICAgIHJlcGF5UGFydChyb3cpewogICAgICBsZXQgdGhhdCA9IHRoaXMKICAgICAgdGhpcy5heGlvcy5wb3N0KCcvbG9hbi9yZXBheS9wYXJ0JywgewogICAgICAgIGlvdU51bTogcm93LmlvdU51bSwKICAgICAgICByZXBheUFtb3VudDogdGhhdC5wYXJ0UmVwYXlBbW91bnQsCiAgICAgIH0pCiAgICAgICAgICAudGhlbihyZXNwb25zZSA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKHJlc3BvbnNlLmRhdGEpCiAgICAgICAgICAgIGlmKHJlc3BvbnNlLmRhdGEubWVzc2FnZT09PSJzdWNjZXNzIikgdGhhdC4kbWVzc2FnZSgn6L+Y5qy+5oiQ5YqfJykKICAgICAgICAgICAgZWxzZSB0aGF0LiRtZXNzYWdlKCfov5jmrL7lpLHotKUnKQogICAgICAgICAgfSkKICAgICAgICAgIC5jYXRjaChlcnJvciA9PiB7CiAgICAgICAgICAgIGNvbnNvbGUubG9nKGVycm9yKQogICAgICAgICAgfSkKICAgIH0KICB9Cn0K"},{"version":3,"sources":["Index.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA6GA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"Index.vue","sourceRoot":"src/views/LoanRepayment","sourcesContent":["<template>\n  <div>\n    <SearchUser @search-user-event=\"showData\"/>\n    <el-table\n        :data=\"tableData\"\n        border\n        style=\"margin-top: 30px\">\n      <el-table-column\n          prop=\"iouNum\"\n          label=\"借据号\">\n      </el-table-column>\n      <el-table-column\n          prop=\"customerCode\"\n          label=\"客户号\">\n        {{ code }}\n      </el-table-column>\n      <el-table-column\n          prop=\"customerName\"\n          label=\"客户名\">\n        {{ name }}\n      </el-table-column>\n      <el-table-column\n          prop=\"productName\"\n          label=\"贷款产品\">\n      </el-table-column>\n      <el-table-column\n          prop=\"productCode\"\n          label=\"贷款产品编号\">\n      </el-table-column>\n      <el-table-column\n          prop=\"overdueAmount\"\n          label=\"逾期金额(元)\">\n      </el-table-column>\n      <el-table-column\n          prop=\"createTime\"\n          label=\"发放日期\">\n      </el-table-column>\n      <el-table-column\n          prop=\"actions\"\n          label=\"操作\">\n        <template slot-scope=\"scope\">\n          <el-button @click=\"repay(scope.row)\" type=\"text\" size=\"small\">详情</el-button>\n          <el-dialog\n              title=\"详情\"\n              :visible.sync=\"repayDialogVisible\"\n              width=\"50%\"\n          >\n            <p style=\"font-size: 20px\">未还账单：</p>\n            <el-table\n                :data=\"unpayTableData\"\n            >\n              <el-table-column\n                  prop=\"planNum\"\n                  label=\"期数\"\n              ></el-table-column>\n              <el-table-column\n                  prop=\"planDate\"\n                  label=\"计划还款日期\"\n              ></el-table-column>\n              <el-table-column\n                  prop=\"status\"\n                  label=\"贷款状态\"\n              ></el-table-column>\n              <el-table-column\n                  prop=\"planPrincipal\"\n                  label=\"本金\"\n              ></el-table-column>\n              <el-table-column\n                  prop=\"planInterest\"\n                  label=\"利息\"\n              ></el-table-column>\n              <el-table-column\n                  prop=\"remainAmount\"\n                  label=\"剩余应还金额\"\n              ></el-table-column>\n              <el-table-column\n                  prop=\"fine\"\n                  label=\"罚金\"\n              ></el-table-column>\n            </el-table>\n            <el-row style=\"display: flex;align-items: center;margin-top: 10px\">\n              <el-col :span=\"8\">\n                <p style=\"font-size: 20px\">总罚金：{{totalFine}}元</p>\n              </el-col>\n              <el-col :span=\"16\">\n                <el-button type=\"primary\" :disabled=\"totalFine<=0\" @click=\"payFine(scope.row)\">支付罚金</el-button>\n              </el-col>\n            </el-row>\n            <p style=\"font-size: 20px\">应还总金额：{{payOverdueAmount}}元</p>\n            <el-row style=\"display: flex;align-items: center;margin-top: 15px\">\n              <el-col :span=\"8\">\n                <el-button type=\"success\" :disabled=\"payOverdueAmount<=0 || (!paidFine && totalFine>0)\" @click=\"repayAll(scope.row)\">全额还款（本期）</el-button>\n              </el-col>\n              <el-col :span=\"16\">\n                <el-row>\n                  <el-input v-model=\"partRepayAmount\" placeholder=\"请输入还款金额\">\n                    <el-button slot=\"append\" :disabled=\"payOverdueAmount<=0 || (!paidFine && totalFine>0)\" @click=\"repayPart(scope.row)\">部分还款</el-button>\n                  </el-input>\n                </el-row>\n              </el-col>\n            </el-row>\n          </el-dialog>\n        </template>\n      </el-table-column>\n    </el-table>\n  </div>\n</template>\n\n<script>\nimport SearchUser from \"@/components/SearchUser\";\n\nexport default {\n  name: \"Index\",\n  components: {SearchUser},\n  data() {\n    return {\n      tableData: [],\n      code: \"\",\n      name: \"\",\n      repayDialogVisible: false,\n      unpayTableData: [],\n      totalFine: 0,\n      paidFine: false,\n      partRepayAmount: null,\n      payOverdueAmount: 0,\n    }\n  },\n  methods: {\n    async showData(data) {\n      this.code = data.code\n      this.name = data.name\n      let loans = await this.getLoanList(this.code)\n      let tempData = []\n      for (let i = 0; i < loans.length; i++) {\n        let temp = {}\n        temp.iouNum = loans[i].iouNum\n        temp.overdueAmount = loans[i].dueBalance\n        temp.createTime = loans[i].loadDate.split(\"T\")[0]\n        temp.productName = loans[i].productName\n        temp.productCode = loans[i].productCode\n        tempData.push(temp)\n      }\n      this.tableData = tempData\n    },\n    async getLoanList(code) {\n      let response = await this.axios.get('/loan/customerLoans?code=' + code)\n      let loanList = response.data\n      return loanList\n    },\n    repay(row) {\n      this.payOverdueAmount = row.overdueAmount\n      this.repayDialogVisible = true\n      let that = this\n      this.axios.get('/loan/unPayPlans?iouNum=' + row.iouNum)\n          .then(response => {\n            let unPayPlans = response.data\n            let tempData = []\n            for(let i=0;i<unPayPlans.length;i++){\n              let temp = unPayPlans[i]\n              temp.planNum = \"第\"+temp.planNum+\"期\"\n              temp.planDate = temp.planDate.split(\"T\")[0]\n              switch (temp.status) {\n                case 0: temp.status = \"默认\"\n                  break\n                case 1: temp.status = \"逾期，有罚金未还\"\n                  break\n                case 2: temp.status = \"逾期，已还罚金\"\n                  break\n                case 3: temp.status = \"正常还款\"\n                  break\n              }\n              tempData.push(temp)\n              that.totalFine += temp.fine\n            }\n            that.unpayTableData = tempData\n          })\n    },\n    payFine(row){\n      let that = this\n      this.axios.post('/loan/fine',{\n        iouNum: row.iouNum\n      })\n          .then(response => {\n            console.log(response.data)\n            if(response.data.message===\"repay fine success\") that.$message('支付罚金成功')\n            else that.$message('支付罚金失败')\n          })\n          .catch(error => {\n            console.log(error)\n          })\n    },\n    repayAll(row){\n      let that = this\n      this.axios.post('/loan/repay/all', {\n        iouNum: row.iouNum,\n      })\n        .then(response => {\n          console.log(response.data)\n          if(response.data.message===\"success\") that.$message('还款成功')\n          else that.$message('还款失败')\n        })\n        .catch(error => {\n          console.log(error)\n        })\n    },\n    repayPart(row){\n      let that = this\n      this.axios.post('/loan/repay/part', {\n        iouNum: row.iouNum,\n        repayAmount: that.partRepayAmount,\n      })\n          .then(response => {\n            console.log(response.data)\n            if(response.data.message===\"success\") that.$message('还款成功')\n            else that.$message('还款失败')\n          })\n          .catch(error => {\n            console.log(error)\n          })\n    }\n  }\n}\n</script>\n\n<style scoped>\n\n</style>\n"]}]}